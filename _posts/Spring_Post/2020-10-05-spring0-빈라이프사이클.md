---
title   : "빈 생명주기"
categories : 
    - Spring
tags : 
    - java
    - spring
    - web
sidebar:
    title: "Spring"
    nav : sidebar-posts
---  

스프링 빈은 간단하게 다음과 같은 라이프사이클을 가진다.  

__객체생성 -> 의존관계 주입__  

스프링 빈은 객체를 생성하고 의존관계 주입이 다 끝난 다음에야 필요한 데이터를 사용할 수 있는 준비가 완료된다.  

따라서 초기화 작업은 의존관게 주입이 모두 완료되고 난 다음에 호출 해야한다.  

스프링은 의존관계 주입이 완료되면 스프링 빈에게 콜백 메서드를 통해서 초기화 시점을 알려주는 다양한 기능을 제공한다.  

또한 스프링은 스프링 컨테이너가 종료되기 직전에 소멸 콜백을 준다. 따라서 안전하게 종료 작업을 진행할 수 있다.  

초기화와 소멸 과정이 필요한 예가 데이터베이스 커넥션 풀이다. 커넥션 풀을 위한 빈 객체는 초기화 과정에서 데이터베이스 연결을 생성한다.  
컨테이너를 사용하는 동안 연결을 유지하고 빈 객체를 소멸할 때 사용중인 데이터베이스 연결을 끊어야 한다.  

#### 스프링 빈의 이벤트 라이프 사이클  

__스프링 컨테이너 생성 -> 스프링 빈 생성 -> 의존관계 주입 -> 초기화 콜백 -> 사용 -> 소멸전 콜백 -> 스프링 종료__  

- 초기화 콜백: 빈이 생성되고, 빈의 의존 관계 주입이 완료된 후 호출한다.
- 소멸전 콜백: 빈이 소멸되기 직전에 호출한다.  

스프링은 다양한 방식으로 생명주기 콜백을 지원한다.  
- 인터페이스(InitalizingBean, DiposableBean)
- 설정 정보에 초기화 메서드, 종료 메서드 지정
- @PostConstruct, @PreDestroy 애노테이션  

싱글톤 빈들은 스프링 컨테이너가 종료될 때 싱글톤 빈들도 함께 종료되기 때문에 스프링 컨테이너가 종료되기 직전에 소멸전 콜백이 일어난다.  
싱글톤 처럼 컨테이너의 시작과 종료까지 생존하는 빈도 있지만, 생명주기가 짧은 빈들도 있다. 이 빈들은 컨테이너와 무관하게 해당 빈이 종료되기 직전에 소멸전 콜백이 일어난다.  

### InitializingBean, DiposableBean  
InitializingBean 인터페이스를 구현하면 스프링 컨테이너는 초기화 과정에서 빈 객체의 __afterPropertiesSet()__ 을 실행한다.  
빈 객체를 생성한 뒤에 초기화 과정이 필요 하면 InitalizingBean 인터페이스를 afterPropertiesSet()을 알맞게 구현하자.

DiposableBean 인터페이를 구현할 경우 소멸 과정에서 빈 객체의 __destroy()__ 메서드를 실행한다.  
빈 객체의 소멸 과정이 필요하면 DiposableBean 인터페이스를 상속하고 destroy() 메서드를 알맞게 구현하자.  

위 인터페이스를 구현하는 것은 단점이 있다.  

스프링 전용 인터페이스여서 해당 코드가 스프링에 의존한다는 점이 있다.  
초기화, 소멸 메서드의 이름을 변경할 수 없다.  
내가 코드를 고칠 수 없는 외부 라이브러리에 적용할 수 없다.  

> 인터페이스를 사용하는 초가화, 종료 방법은 스프링 초창기에 나온 방법이어서 지금은 거의 사용하지 않는다.  


### 빈 등록 초기화, 소멸 메서드 지정  
설정 정보에 @Bean(initMethod = "init", destroyMethod = "close")처럼 초기화 및 소멸 메서드를 지정할 수 있다.  

```java
public class Example {

    ...

    public void init() {
        ...
    }

    public void close() {
        ...
    }
}


@Configuration
public class exConfig {

    @Bean(initMethod = "init", destroyMethod = "close")
    public Example example {
        ...
    }
}
```

위 방식은 메서드 이름을 자유롭게 지정 할 수 있다.  

스프링 빈이 스프링 코드에 의존하지 않는다.  

코드가 아니라 설정 정보를 사용하기 때문에 코드를 고칠 수 없는 외부 라이브러리에도 초기화, 종료 메서드를 적용할 수 있다.  


### @PostConstruct, @PreDestroy
```java
public class Example {

    ...

    @PostConstruct
    public void init() {
        ...
    }

    @PreDestroy
    public void close() {
        ...
    }
}

위 방식은 현재 최신 스프링에서 가장 권장하는 방법이다. 애노테이션 하나만 붙이면 되므로 매우 편리하다는 장점이 있다.  

스프링에 종속적인 기술이 아니라 자바 표준이어서 스프링이 아닌 다른 컨테이너에서도 동작한다.  

하지만 외부 라이브러리에는 적용할 수 없다는 점이 있다. 개발 중 외부 라이브러리를 초기화 및 종료 해야 할 경우가 있다면 `@Bean`의 기능을 사용하자.  




---

참고  
- __초보 웹 개발자를 위한 스프링5 프로그래밍 입문__
- __인프런 스프링 핵심 원리 - 기본편__